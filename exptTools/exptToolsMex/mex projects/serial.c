#include <stdlib.h>#include <stdio.h>#include "SerialLib.h"#include "mex.h"#define MAX_STR_NAME_LENGTH 64SerialInfo Ainfo;void CloseSerial();void mexFunction(int nlhs, mxArray *plhs[], int nrhs, const mxArray *prhs[]){	static int firstTime = 1;	int i, count;	char string[MAX_STR_NAME_LENGTH];	// Check arguments	if (nrhs > 1) {		printf("Usage: serialIn = serial(['string'])");		exit;	}	if (mxIsChar(prhs[0]) != 1) {		printf("Usage: serialIn = serial('string')");		exit;	}	// On first time through, initialize serial port	// and set up routine for closing it on exit.	if (firstTime == 1) {		SerialInit(&Ainfo,".AIn",".AOut");		if (Ainfo.inRefNum == -1 || Ainfo.outRefNum == -1) {			printf("serial: error initializing serial port");			exit;		}		SerialSetSpeed(&Ainfo,10);   //  Defined constant "baud9600" equals 10		mexAtExit(CloseSerial);		firstTime = 0;	}		// Get string from first argument	if (mxGetString(prhs[0],string,MAX_STR_NAME_LENGTH) != 0) {	  mexErrMsgTxt("serialOut: error converting MATLAB string to C char array.");	}			SerialWriteCR(&Ainfo,string);	count = SerialCharsAvail(&Ainfo);	if (count > 0L) {		GetSerialChars(&Ainfo, count);		//mxPutString(plhs[0],Ainfo->inCharBuf,count);	}}void CloseSerial(){	// mex_printf("Colorimeter Driver Closed\r");	SerialClose(&Ainfo);}