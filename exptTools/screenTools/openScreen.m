function display = openScreen(display, makeMovieFlag)%function display = openScreen(display, [makeMovieFlag])if ~exist('makeMovieFlag','var')	makeMovieFlag = 0;endif ~isfield(display,'screenNumber')	display.screenNumber=0;	disp('Using default screen number of 0');endif ~isfield(display,'numColors')	display.numColors = 256;	disp('Using default number of colors of 256');endif ~isfield(display,'frameRate')	display.frameRate = 200/3;	disp('Using default frame rate of 66.67 Hz');endif ~isfield(display,'pixelDepth');	display.pixelDepth = 8;	disp('Using default pixel depth of 8 bits');endif ~isfield(display,'gammaTable');	display.gammaTable = linspace(0,2^display.pixelDepth-1,display.numColors)';	disp('Using default linear gamma table');endif ~isfield(display,'pixelSize');	display.pixelSize = 0.0691;	disp('Using default pixel size of 0.0691 cm');endif ~isfield(display,'distance');	display.distance = 127.5;	disp('Using default display distance of 127.5 cm');endbkColorNum = findName(display.reservedColor,'background');if isempty(bkColorNum)	if ~isfield(display,'reservedColor')		bkColorNum = 1;	else		bkColorNum = size(display.reservedColor,2)+1;	end	display.reservedColor(bkColorNum).name ='background';	display.reservedColor(bkColorNum).fbVal = 0;	display.reservedColor(bkColorNum).gunVal= [0.5,0.5,0.5];	disp(['Setting background to display.reservedColor(',num2str(bkColorNum),'), grey']);endcmap = greyCmap(display);if ~makeMovieFlag		if exist('oldSCREEN.m','file')		rmpath([matlabroot filesep 'Toolbox' filesep 'exptTools' filesep 'movieTools']);	end	%Open the screen and save the window pointer and rect	[display.windowPtr,display.rect]=SCREEN(display.screenNumber,'OpenWindow',...                                     display.reservedColor(bkColorNum).fbVal,[],...									 fix(log(display.numColors)/log(2)));	if display.cmapDepth == 10		[cmap,gamma] = tenBit2eightBit(display,cmap);	else		gamma = setDisplayGamma(display);	end		SCREEN(display.windowPtr,'Gamma',gamma,display.pixelDepth)	SCREEN(display.windowPtr,'SetClut',cmap);else	addpath([matlabroot filesep 'Toolbox' filesep 'exptTools' filesep 'movieTools']);		if display.cmapDepth~=8		error('You can''t do the movie thing if cmapDepth isn''t 8.');	end		dimensions = strtok(display.resolution,',');	xdimension = str2num(strtok(dimensions,'x'));	ydimension = str2num(fliplr(strtok(fliplr(dimensions),'x')));	display.rect = [0 0 xdimension ydimension];	display.windowPtr = display;	figure;	set(gcf,'sharecolors','off','renderer','painters');	global offScreenImages;		set(gcf,'MinColormap',display.numColors);	set(gcf,'ShareColors','off');	colormap(cmap/255.0);	bgndIndex=findName(display.reservedColor,'background');	background = display.reservedColor(bgndIndex).fbVal;	SCREEN(display.windowPtr,'OpenOffScreenWindow',background);	SCREEN('copywindow',1);	%This is some fleet thing.  We'll get rid of this in a sec...		%set up a dummy window and leave it in the background for now	%figure('Position',[1 1 2 2]);	%imborder('tight');	%set(gcf,'MinColormap',display.numColors);	%set(gcf,'ShareColors','off');	%imshow(zeros(2));	%colormap(greyScaleCmap(display)/255.0);	% SHOULD SAVE A HANDLE TO THIS FIGURE AND MOVE IT OFF SCREEN.end									 %Set gray cmap and appropriate gamma table.  If 8 bit cmap is used, call what%has been called 'setDisplayGamma' (though this name should change).									 