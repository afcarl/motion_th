function saveImages(dir, baseFilename, im, cmap, gamma, maxGunVal)% saveImages(dir, baseFilename, im, cmap, [gamma], [maxGunVal])% %   Saves the images specified by im and cmap as tiff files.  %   Note that there may be more than one image and/or more than one%   cmap., in which case every possible combination of cmap and im%   will be produced.%   im should have values 0-255.%   If gamma does not exist or is empty, cmap must be 0-maxGunVal,%   else cmap must be 0-255 and gamma must be 0-maxGunVal.%   (maxGunVal defaults to 255.)%% 99.03.09 RFDif ~exist('maxGunVal', 'var')    maxGunVal = 255;elseif isempty(maxGunVal)    maxGunVal = 255;endstat = mkdir(dir);cd(dir);im = uint8(im);numCmaps = size(cmap,3);numImages = size(im,3);% convert cmaps to valid matlab cmaps (0-1)if exist('gamma', 'var') & ~isempty(gamma)    for i=1:numCmaps    	cmap(:,1,i) = gamma(cmap(:,1,i)+1, 1, i)./maxGunVal;    	cmap(:,2,i) = gamma(cmap(:,2,i)+1, 2, i)./maxGunVal;    	cmap(:,3,i) = gamma(cmap(:,3,i)+1, 3, i)./maxGunVal;    endelse    cmap = cmap./maxGunVal;endfor i=1:numCmaps    for j=1:numImages        imwrite(im(:,:,j), cmap(:,:,i), ...                [baseFilename num2str(i+(j-1)*numCmaps,'%.3d') '.tif'], ...                'tiff');    endendcd('..');