function balisticStimulus = createBalScanStimulus(scan)% balisticStimulus = createBalScanStimulus(scan)%% Used by  showBalisticScan  to create a stimulus structure from the% scan structure  so that the scan can be displayed with showStimulus% % simply concatenate the image and cmap arraysnewImages = cat(3,scan.stimulus1.image,scan.stimulus2.image);newCmaps = cat(3,scan.stimulus1.cmap,scan.stimulus2.cmap);% adjusting the indices of the SEQ takes a little more work:% Add nImages1 to all positive entries in seq2, and% subtract nCmaps1 from all negative entries in seq2seq2 = scan.stimulus2.seq;nImages1 = size(scan.stimulus1.image,3);mask = seq2 > 0;seq2 = seq2 + nImages1 * mask;nCmaps1 = size(scan.stimulus1.cmap,3);mask = seq2 < 0;seq2 = seq2 - nCmaps1 * mask;% concatentate new seq2 with stimulus1.seq and repeat according to nCyclescycleSeq = [scan.stimulus1.seq(:);seq2(:)];newSeq = cycleSeq * ones(scan.nCycles,1)';newSeq=newSeq(:)';balisticStimulus = createStimulusStruct(newImages,newCmaps,newSeq);