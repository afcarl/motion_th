function response = showScan(display,scan,runPriority,showTiming);%response = showScan(display,scan,runPriority);if ~exist('showTiming')	showTiming = 0;end startSecs = 5;startScan = 3;% Draw all images off screendispStringInCenter(display,'Storing images...',0.4,'white');for trialNum=1:length(scan.trial);  scan.trial(trialNum).stimulus=createImagePointers(display,scan.trial(trialNum).stimulus);  if isfield(scan.trial(trialNum),'ISIstimulus')    scan.trial(trialNum).ISIstimulus=createImagePointers(display,scan.trial(trialNum).ISIstimulus);  endenddispStringInCenter(display,'Storing images...',0.4,'background');if ~exist('runPriority')  runPriority = 0; 			%use the nicest priority by defaultendnTrials = prod(size(scan.trialNumberSeq));response = NaN * ones(1,nTrials);if isfield(scan,'dispString')  pressKey2Begin(display,scan.dispString);else  pressKey2Begin(display);endcountDown(display,startSecs,startScan);time=getSecs;for trialNum=1:nTrials  response(trialNum) = showTrial(display,scan.trial(scan.trialNumberSeq(trialNum)),runPriority);  if response(trialNum) == -1    return  end	  waitTill(trialNum*scan.ITI,time);	endif showTiming  disp(['Stimulus time: ',num2str(getSecs-time)]);end;