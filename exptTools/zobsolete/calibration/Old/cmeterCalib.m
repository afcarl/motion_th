%%% using cmeter to calibrate screentargetSize = [870 1152];gunColors = [1 0 0; 0 1 0; 0 0 1; 1 1 1] * 1023;[gunSpects, wavelengths, gunXYZ] = cmeterSpectraCalib(targetSize, gunColors);gunColors = [1 0 0; 0 1 0; 0 0 1];fbValues = 0:31:1023;gammaValues = cmeterGammaCalib(targetSize, gunColors, fbValues);save calibRawAug97.mat;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% make spectra fileload coneSpectra;spectraWavelength = 380:730;coneSpectra = coneSpectra(11:361,:);sampling = wavelengths(2) - wavelengths(1);monitorSpectra = interp1(wavelengths, gunSpects, spectraWavelength)/sampling;RGB2XYZ2 = gunXYZ(:, 1:3);RGB2LMS = coneSpectra' * monitorSpectra(:,1:3);save monitorSpectraAug97.mat monitorSpectra spectraWavelength;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% make gamma table%% discard first few data points that are not monotonic%% (ideally, should re-measure to make sure)t = [max(find(diff(gammaValues(:,1))<=0)) ...     max(find(diff(gammaValues(:,2))<=0)) ...     max(find(diff(gammaValues(:,3))<=0))];gammaValues(1:max(t),:) = [];fbValues(1:max(t)) = [];%% assume screen is truly black when framebuffer=0%% this is probably not true but the error is at most 0.5% for this calib.fbValues = [0 fbValues];gammaValues = [0 0 0; gammaValues];%% normalize gammaTable to 1gammaValues = gammaValues * diag(1./max(gammaValues));%% interpolate to full sizefb = 0:1023;gamma10 = interp1(fbValues, gammaValues, fb');n = 4095;levels = [0:n]/n;invGamma10 = zeros(n+1, 3);invGamma10(:,1) = interp1(gamma10(:,1), fb/1023, levels);invGamma10(:,2) = interp1(gamma10(:,2), fb/1023, levels);invGamma10(:,3) = interp1(gamma10(:,3), fb/1023, levels);invGamma10 = round(invGamma*1023)/1023;save newCalib RGB2LMS RGB2XYZ2 gamma10 invGamma10;