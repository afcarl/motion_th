function cmap = makeFlickerCmap(display,params)%cmap = makeFlickerCmap(display,params);nFrames = getFrames(display,params.duration);[lowCol,highCol]=getFreeColors(display);cmap = uint8(zeros(display.numColors,3,nFrames));%this trick makes one cycle less one image for smooth repetitiontime = linspace(0,params.duration,nFrames+1);time = time(1:nFrames);x = linspace(0,1,highCol-lowCol+1)';frameCount = 0;for t = time;	frameCount = frameCount+1;	f = (display.numColors-1)*(params.contrast*cos(2*pi*params.temporalFrequency*t-params.temporalPhase)*cos(2*pi*x)+1)/2;	cmap(lowCol+1:highCol+1,1:3,frameCount) = uint8(f*ones(1,3));endcmap = uint8(insertReservedCols(display,cmap));