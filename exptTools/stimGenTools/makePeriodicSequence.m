function seq = createPeriodicSequence(display, params)if ~isfield(params,'temporal')	error('temporal paramaters must be specified.')endif ~isfield(params.temporal,'modulation')	error('temporal.modulation must be present in params');else	temporal.modulation = params.temporal.modulation;endif ~(strcmp(temporal.modulation,'flickerSinusoid') | strcmp(temporal.modulation,'flickerSquare') | strcmp(temporal.modulation,'drift') | strcmp(temporal.modulation,'static'))	error('temporal.modulation must be either flickerSinusoid, flickerSquare, drift, or static.');endif isfield(params.temporal,'memoryFlag')	temporal.memoryFlag = params.temporal.memoryFlag;else	temporal.memoryFlag = 0;endif ~isfield(params,'duration')	error('Must provide a stimulus duration.');else	duration = params.duration;endframesPerTrial = round (display.frameRate * duration);if (strcmp(temporal.modulation,'static'))		numFrames = 1;	else	if isfield(params,'spatial')		if isfield(params.spatial,'envelope')			if ~isfield(params.spatial.envelope,'shape')				error('spatial.envelope must have a shape');			else				spatial.envelope.shape = params.spatial.envelope.shape;			end		else			spatial.envelope.shape = 'none';		end	else		spatial.envelope.shape = 'none';	end	if ~isfield(params.temporal,'frequency')		error('temporal.frequency must be present.');	else		temporal.frequency = params.temporal.frequency;	end		framesPerCycle = round (display.frameRate / abs(temporal.frequency));	numFrames = min([framesPerCycle framesPerTrial]);end% 99.12.02 RFD: removed the following check:%if (strcmp(temporal.modulation,'drift') & ~strcmp(spatial.envelope.shape,'none')) % if blitting...%	seq = [-1 repmat(1:numFrames, [1 ceil(framesPerTrial/numFrames)])];%else% because makePeriodicImages nowchecks for memory flag for blit stimuli. if temporal.memoryFlag	seq = [1 -repmat(1:numFrames, [1 ceil(framesPerTrial/numFrames)])];else	seq = [1 -(1:framesPerTrial)];end% the seq has negtives for the frame animation and a positive to start with, % so if we are blitting, we need to flip all the signs.if (strcmp(temporal.modulation,'drift') & ~strcmp(spatial.envelope.shape,'none')) % if blitting	seq = -seq;endseq = seq(1:(framesPerTrial+1));